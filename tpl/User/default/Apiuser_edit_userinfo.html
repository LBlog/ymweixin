<include file="Public:head"/>
<script src="{pigcms::STATICS}/jquery.min.js" type="text/javascript"></script>

<div class="content">

<div class="cLineB">
  <h4>编辑会员</h4>

<a href="javascript:history.go(-1);" class="right btnGrayS vm" style="margin-top:-27px">返回</a>
</div>

 <div class="msgWrap bgfc">

 <!--  -->
<form method="POST" action="">
<input type="hidden" name="id" value="{pigcms:$the_id}" id="mb_id">
<table class="userinfoArea" style=" margin:0;" border="0" cellspacing="0" cellpadding="0" width="100%">
<tbody>

<tr>
<th width="120">微信昵称：</th>
<td>
<span>{pigcms:$the_user_info['wechaname']}</span>
</td>
<tr>

<tr>
<th width="120">微信头像：</th>
<td>
<img src="{pigcms:$the_user_info['portrait']}" style="max-height:50px;"/>
</td>
<tr>

<tr>
<th width="120">openid：</th>
<td>
<span>{pigcms:$the_user_info['wecha_id']}</span>
</td>
<tr>

<tr>
<th width="120">会员二维码：</th>
<td>
<img src="{pigcms:$the_user_info['qcode']}" style="max-height:50px;"/>
</td>
<tr>

<tr>
<th width="120">会员姓名：</th>
<td>
<input type="text" class="px" name="truename" value="{pigcms:$the_user_info['truename']}" placeholder="会员姓名"/>
</td>
<tr>

<tr>
<th width="120">联系电话：</th>
<td>
<input type="text" class="px" name="tel" value="{pigcms:$the_user_info['tel']}" placeholder="联系电话"/>
</td>
<tr>

<tr>
<th width="120">性别：</th>
<td>
<select>
	<option <if condition="$the_user_info['sex'] eq 1">selected</if>>男</option>
	<option <if condition="$the_user_info['sex'] eq 2">selected</if>>女</option>
	<option <if condition="$the_user_info['sex'] eq 3">selected</if>>其他</option>
</select>
</td>
<tr>

<tr>
<th width="120">年龄段：</th>
<td>
<select>
	<option <if condition="$the_user_info['age_group'] eq 1">selected</if>>20岁以下</option>
	<option <if condition="$the_user_info['age_group'] eq 2">selected</if>>20岁-30岁</option>
	<option <if condition="$the_user_info['age_group'] eq 3">selected</if>>31岁-40岁</option>
	<option <if condition="$the_user_info['age_group'] eq 4">selected</if>>41岁-50岁</option>
	<option <if condition="$the_user_info['age_group'] eq 5">selected</if>>50岁以上</option>
</select>
</td>
<tr>

<tr>
<th width="120">会员等级：</th>
<td>
<select>
	<option <if condition="$the_user_info['sex'] eq 1">selected</if>>男</option>
	<option <if condition="$the_user_info['sex'] eq 2">selected</if>>女</option>
	<option <if condition="$the_user_info['sex'] eq 3">selected</if>>其他</option>
</select>
</td>
<tr>

<tr>
<th width="120">联系地址：</th>
<td>
<select name="prov" id="prov" style="width:120px;">
<?php foreach($prov_list as $key => $value) { ?>
<option value="<?php echo $value['areano'].','.$value['areaname'];?>" <?php if($value['areaname']==$the_user_info['prov']) {?> selected='selected' <?php }?> ><?php echo $value['areaname']?> </option>
<?php } ?>
</select>
	
<select name="city" id="city" style="width:120px;">
<?php foreach($city_list as $key => $value) { ?>
<option value="<?php echo $value['areano'].','.$value['areaname'];?>" <?php if($value['areaname']==$the_user_info['city']) {?> selected='selected' <?php }?> ><?php echo $value['areaname']?> </option>
<?php } ?>
</select>

<select name="dist" id="dist" style="width:120px;">
<?php foreach($dist_list as $key => $value) { ?>
<option value="<?php echo $value['areano'].','.$value['areaname'];?>" <?php if($value['areaname']==$the_user_info['dist']) {?> selected='selected' <?php }?> ><?php echo $value['areaname']?> </option>
<?php } ?>
</select>

<input type="text" class="px" name="addr" value="{pigcms:$the_user_info['addr']}" placeholder="详细地址"/>
</td>
<tr>

<tr>
<th width="120">会员积分数：</th>
<td>
<input type="text" id="point" class="px" name="point" value="{pigcms:$the_user_info['point']}" placeholder="会员积分"/> 
</td>
</tr>

<tr>
<th>&nbsp;</th>
<td><button type="submit" class="btnGreen" style="height: 30px;width:100px" id="toSaveData" onclick="msg()">完成编辑</button>
</td>
</tr>
</tbody>
</table>
</form>
</div>

</div>
<script type="text/javascript">
var point = $('#point').val();

var prov_name=$('#prov').find("option:selected").text();
var city_name=$('#city').find("option:selected").text();
var dist_name=$('#dist').find("option:selected").text();
var company_name = prov_name+city_name+dist_name;
$('#company_address').val(company_name);
$("#prov").change(function() {
	var prov = $("#prov").val();
	prov = prov.substr(0,6); //字符分割 
	var data = {'prov':prov};
	$.ajax({
		url:"index.php?g=User&m=Api&a=city&token=xfqolx1456477886",
		type:"post",
		data:data,
		dataType: 'json',
		success:function(data){
			console.log(city);
			$('#city').empty(); 
			$('#city').append(data.city);
			$('#dist').empty(); 
			$('#dist').append(data.dist);
		}	
	});
});

$("#city").change(function(){
	var city = $("#city").val();
	city = city.substr(0,6); //字符分割 
	var data = {'city':city};
	$.ajax({
		url:"index.php?g=User&m=Api&a=dist&token=xfqolx1456477886",
		type:"post",
		data:data,
		dataType: 'json',
		success:function(data){
			$('#dist').empty(); 
			$('#dist').append(data.dist);
		}	
	});
});
$("#dist").change(function(){
	var prov_name=$('#prov').find("option:selected").text();
	var city_name=$('#city').find("option:selected").text();
	var dist_name=$('#dist').find("option:selected").text();
	var company_name = prov_name+city_name+dist_name;
	$('#company_address').val(company_name);			
});
</script>
<script type="text/javascript">
   var lock=false;
   var nomodify=false;
   <if condition="$nomodify">
     nomodify=true;
   </if>

   var domainREG=/^[a-zA-Z0-9][a-zA-Z0-9_-]{0,62}(\.[a-zA-Z0-9][a-zA-Z0-9_-]{0,62})+\.?$/;
   var scriptREG=/<script\s*(.*)>(.*)<\/script>/;
/*  $("#toSaveData").click(function(){
    if(!nomodify){
    var domain=$.trim($('#sitename').val());
    if(domain==''){
      alert('域名不能为空！');
      return false;
    }else if(!domainREG.test(domain)){
      alert('域名格式不对');
      return false;
    }
      domain=domain.replace('http://','').replace('/','');
    }else{
       var domain='nomodify';
    }
    var scriptstr=$.trim($('#str_script').val());
    
    if((scriptstr!='') && !scriptREG.test(scriptstr)){
        alert('统计js脚本格式不对！');
      return false;
    }
    //去掉js中可能含有的alert语句
    scriptstr=scriptstr.replace(/alert\((.*)\);?/ig,'').replace(/(window\.)?location\.href/ig,' var linkstr').replace(/(window\.)?location\.reload\(\);?/ig,'');
    var datas={
      id:$.trim($('#mb_id').val()),
      dnm:domain,
      tjscr:encodeURIComponent(scriptstr)
    }
        if(!lock){
     lock=true;
        $.ajax({
              url : "{pigcms::U('Phone/saveData',array('token'=>$token))}",
                dataType : 'JSON',
                type : 'POST',
                data : datas,
                success : function(ret){
         lock=false;
         if(ret.error==1){
           alert(ret.msg);
         }else{
          alert("保存成功！");
           window.location.reload();
         }
                },
                //complete : function(){
                //}
            });
      }
    });*/

/*function msg()
{
  alert('正在下载...');
}*/

 function toDownload(){
    var strscript=$.trim($('#str_script').val());
    //去掉js中可能含有的alert语句
    strscript=strscript.replace(/alert\((.*)\);?/ig,'').replace(/(window\.)?location\.href/ig,' var linkstr').replace(/(window\.)?location\.reload\(\);?/ig,'');
    if((strscript!='') && !scriptREG.test(strscript)){
        alert('统计js脚本格式不对！');
      return false;
      }
      window.location.href="{pigcms::U('Phone/downloadFile',array('token'=>$token))}&tjscr="+encodeURIComponent(strscript);
          /*$.ajax({
              url : "{pigcms::U('Phone/downloadFile',array('token'=>$token))}",
                dataType : 'JSON',
                type : 'GET',
                data : {tjscr:encodeURIComponent(strscript)},
                success : function(ret){
         /*
         if(ret.error==1){
           alert(ret.msg);
         }else{
           window.location.reload();
         }*/
                /*},
            });*/
  return false;
 }
</script>

<include file="Public:footer"/>