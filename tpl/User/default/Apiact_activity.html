<include file="Public:head"/>  
<script src="/tpl/static/artDialog/jquery.artDialog.js?skin=default"></script>
<script src="/tpl/static/artDialog/plugins/iframeTools.js"></script>
<script src="{pigcms::RES}/js/cart/jscolor.js" type="text/javascript"></script>
<div class="content">
<div class="cLineB">
<div class="cLineB">
  <h4>活动管理</h4>
</div>
<div class="clr"></div>
<ul id="tags">
  <li><a href="{pigcms::U('Apiact/add_activity',array('token'=>$token))}">添加活动</a> </li>
</ul>
<div class="clr"></div>
</div>
<div class="cLine">
<form method="post"  action="" id="info" >
关键词：
<input type="text" class="px" name="search" value="{pigcms:$search}" style="height:25px;width:150px;" placeholder="请输入活动名称">
<input type="submit" class="btnGrayS" value="搜索">
</form>
<div class="clr"></div>
</div>
<div class="msgWrap">
<form method="post"  action="" id="info" >
<input type="hidden" name="token" value="{pigcms:$token}" id="mb_id">
<TABLE class="ListProduct" border="0" cellSpacing="0" cellPadding="0" width="100%">
<THEAD>
<tr>
<th width="120" style="text-align:center">活动编号</th>
<th width="120" style="text-align:center">活动名称</th>
<th width="120" style="text-align:center">活动图片</th>
<th width="120" style="text-align:center">活动时间</th>
<th width="120" style="text-align:center">活动地址</th>
<th width="120" style="text-align:center">活动人数</th>
<th width="120" style="text-align:center">是否热门</th>
<th width="100" style="text-align:center">操作</th>
</tr>
</THEAD>
<TBODY>
<TR></TR>
<volist id="item" name="activity">
<TR>
<TD style="text-align:center">{pigcms:$item.id}</TD>
<TD style="text-align:center">{pigcms:$item.name}</TD>
<TD style="text-align:center">{pigcms:$item.img}</TD>
<TD style="text-align:center">{pigcms:$item.start_time}~{pigcms:$item.end_time}</TD>
<TD style="text-align:center">{pigcms:$item.act_addr}</TD>
<TD style="text-align:center">{pigcms:$item.people_num}</TD>
<TD style="text-align:center">
<input type="hidden" value="{pigcms:$item.is_hot}" id="ishot"/>
<if condition="$item.is_hot eq 1"> <span>是</span></if>
<if condition="$item.is_hot eq 0"> <span>否</span></if>
</TD>
<TD style="text-align:center"> 
<if condition="$item.is_hot eq 1">
	<a href="javascript:void(0)" onclick="changeStatus(this,{pigcms:$item.id})"><span id="action"> 取消热门  </span></a>
</if>
<if condition="$item.is_hot eq 0">
	<a href="javascript:void(0)" onclick="changeStatus(this,{pigcms:$item.id})"><span id="action">设为热门 </span></a>
</if>
<a href=<?php U('Apiact/edit_activity');?>"?g=User&m=Apiact&a=edit_activity&token={pigcms:$token}&id={pigcms:$item.id}">编辑</a>
<a href="javascript:void(0)" onclick="del(this,{pigcms:$item.id})">删除</a>
</TD>
</TR>
</volist>
</TBODY>
</TABLE>
</form>

</div>
<div class="cLine">
<div class="pageNavigator right">
<div class="pages">{pigcms:$page}</div>
</div>
<div class="clr"></div>
</div>
</div>  
        <div class="clr"></div>
    <include file="Public:footer"/>
      </div>
    </div>
  </div>
<script type="text/javascript" src="../tpl/User/default/common/js/jquery.js"></script>    
<script type="text/javascript" src="../tpl/User/default/common/layer/layer.js"></script> 
<script>
function del(obj,id){ 
  if(confirm("确定删除这个记录？")){
        var data = {"id":id};
        var parent = $(obj).parent().parent();
        $.ajax({
        type:"post",
        url:<?php U('Apiact/ajaxactivity');?>"?g=User&m=Apiact&a=ajaxactivity&token={pigcms:$token}&id={pigcms:$item.id}",
       // dataType:"json",
        data:data,
        success:function(msg){
            console.log(msg);
            if(msg==1){
                parent.remove();
                alert('该记录已删除');
            }
        }
    })
    }
}

/**ajax一键修改热门
 * @param Null
 * @par 2016/03/02 Ver 1.00 Created by tangmin
 */ 
function changeStatus (obj,id) {
 var action = $(obj).children("span").filter("#action");
 var ishot = $(obj).parent("td").siblings("td").find("#ishot");
 var val = ishot.val();
  $.ajax({
    type:"POST",
    url:<?php U('Apiact/act_changesta');?>"?g=User&m=Apiact&a=act_changesta&token={pigcms:$token}&id={pigcms:$item.id}",
    data:"ishot="+val+"&id="+id,
    success:function(msg){
    	if(msg==2){
    		layer.msg("您已经设置三个热门了",{icon:2,time:2000});
    	}
		if(msg==1){ 
			if(val==1){
		    	ishot.attr("value",0);
		    	ishot.siblings("span").html("否");
		    	action.html("设为热门");
		  	}
		  	if(val==0){
		    	ishot.attr("value",1);
		    	ishot.siblings("span").html("是");
		    	action.html("取消热门");
		  	}
		  	layer.msg("设置成功",{icon:1,time:1000});          
		}
		if(msg==0){
		  	layer.msg("设置失败",{icon:2,time:1000});      
		}
    }
  }); 
}
</script>