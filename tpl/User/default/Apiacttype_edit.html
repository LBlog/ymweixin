<include file="Public:head"/>
<script src="{pigcms::STATICS}/jquery.min.js" type="text/javascript"></script>

<div class="content">

<div class="cLineB">
  <h4>编辑活动类别</h4>

<a href="javascript:history.go(-1);" class="right btnGrayS vm" style="margin-top:-27px">返回</a>
</div>

 <div class="msgWrap bgfc">

 <!--  -->
<form method="POST" action="">
<input type="hidden" name="id" value="{pigcms:$the_id}" id="mb_id">
<table class="userinfoArea" style=" margin:0;" border="0" cellspacing="0" cellpadding="0" width="100%">
<tbody>

<tr>
<th width="300">活动类别名称：</th>
<td>
<input type="text" class="px" name="tname" placeholder="活动名称" value="{pigcms:$the_act_type['tname']}" />
</td>
<tr>

<tr>
<th>&nbsp;</th>
<td><button type="submit" class="btnGreen" style="height: 30px;width:100px" id="toSaveData" onclick="msg()">完成编辑</button>
</td>
</tr>
</tbody>
</table>
</form>
</div>
</div>	
<script type="text/javascript">
   var lock=false;
   var nomodify=false;
   <if condition="$nomodify">
     nomodify=true;
   </if>

   var domainREG=/^[a-zA-Z0-9][a-zA-Z0-9_-]{0,62}(\.[a-zA-Z0-9][a-zA-Z0-9_-]{0,62})+\.?$/;
   var scriptREG=/<script\s*(.*)>(.*)<\/script>/;
/*  $("#toSaveData").click(function(){
    if(!nomodify){
    var domain=$.trim($('#sitename').val());
    if(domain==''){
      alert('域名不能为空！');
      return false;
    }else if(!domainREG.test(domain)){
      alert('域名格式不对');
      return false;
    }
      domain=domain.replace('http://','').replace('/','');
    }else{
       var domain='nomodify';
    }
    var scriptstr=$.trim($('#str_script').val());
    
    if((scriptstr!='') && !scriptREG.test(scriptstr)){
        alert('统计js脚本格式不对！');
      return false;
    }
    //去掉js中可能含有的alert语句
    scriptstr=scriptstr.replace(/alert\((.*)\);?/ig,'').replace(/(window\.)?location\.href/ig,' var linkstr').replace(/(window\.)?location\.reload\(\);?/ig,'');
    var datas={
      id:$.trim($('#mb_id').val()),
      dnm:domain,
      tjscr:encodeURIComponent(scriptstr)
    }
        if(!lock){
     lock=true;
        $.ajax({
              url : "{pigcms::U('Phone/saveData',array('token'=>$token))}",
                dataType : 'JSON',
                type : 'POST',
                data : datas,
                success : function(ret){
         lock=false;
         if(ret.error==1){
           alert(ret.msg);
         }else{
          alert("保存成功！");
           window.location.reload();
         }
                },
                //complete : function(){
                //}
            });
      }
    });*/

/*function msg()
{
  alert('正在下载...');
}*/

 function toDownload(){
    var strscript=$.trim($('#str_script').val());
    //去掉js中可能含有的alert语句
    strscript=strscript.replace(/alert\((.*)\);?/ig,'').replace(/(window\.)?location\.href/ig,' var linkstr').replace(/(window\.)?location\.reload\(\);?/ig,'');
    if((strscript!='') && !scriptREG.test(strscript)){
        alert('统计js脚本格式不对！');
      return false;
      }
      window.location.href="{pigcms::U('Phone/downloadFile',array('token'=>$token))}&tjscr="+encodeURIComponent(strscript);
          /*$.ajax({
              url : "{pigcms::U('Phone/downloadFile',array('token'=>$token))}",
                dataType : 'JSON',
                type : 'GET',
                data : {tjscr:encodeURIComponent(strscript)},
                success : function(ret){
         /*
         if(ret.error==1){
           alert(ret.msg);
         }else{
           window.location.reload();
         }*/
                /*},
            });*/
  return false;
 }
</script>

<include file="Public:footer"/>