<include file="Public:head" />
<link rel="stylesheet" href="{pigcms::STATICS}/kindeditor/themes/default/default.css" />
<link rel="stylesheet" href="{pigcms::STATICS}/kindeditor/plugins/code/prettify.css" />
<script src="{pigcms::STATICS}/kindeditor/kindeditor.js" type="text/javascript"></script>
<script src="{pigcms::STATICS}/kindeditor/lang/zh_CN.js" type="text/javascript"></script>
<script src="{pigcms::STATICS}/kindeditor/plugins/code/prettify.js" type="text/javascript"></script>
<script src="/tpl/static/artDialog/jquery.artDialog.js?skin=default"></script>
<script src="/tpl/static/artDialog/plugins/iframeTools.js"></script>

<script type="text/javascript" src="/tpl/static/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="/tpl/static/ueditor/ueditor.all.js"></script>
<script type="text/javascript" charset="utf-8" src="/tpl/static/ueditor/lang/zh-cn/zh-cn.js"></script>  
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=MyhGiIiNiKxzyptRzo4XOdxwNM843snY"></script>
<script>
    var editor;
    KindEditor.ready(function (K) {
        editor = K.create('#intro', {
            resizeType: 1,
            allowPreviewEmoticons: false,
            allowImageUpload: true,
            uploadJson: '/index.php?g=User&m=Upyun&a=kindedtiropic',
            items: [
                'source', 'undo', 'clearhtml', 'hr',
                'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
                'insertunorderedlist', '|', 'emoticons', 'image', 'link', 'unlink', 'baidumap', 'lineheight', 'table', 'anchor', 'preview', 'print', 'template', 'code', 'cut', 'music', 'video', '|', 'forecolor', 'hilitecolor', 'bold', 'italic', 'underline', 'hr', 'fontname', 'fontsize'],
            afterBlur: function () {
                this.sync();
            }
        });
    });
</script>
<div class="content"> 
    <div class="cLineB"> 
        <h4>增加兑换点</h4> 
        <a href="{pigcms::U('Apiext/extlist',array('token'=>$token))}" class="right  btnGreen" style="margin-top:-27px">返回</a> 
    </div>
    <div style="background:#fefbe4;border:1px solid #f3ecb9;color:#993300;padding:10px;margin-top:5px;">
        <span>温馨提示：</span>
        <p>兑换点添加功能模块</p>
    </div> 
    <form method="post" action="" id="formID">
        <div class="msgWrap bgfc"> 
            <table class="userinfoArea" style=" margin:0;" border="0" cellspacing="0" cellpadding="0" width="100%"> 
                <tbody> 
                    <tr> 
                        <th><span class="red">*</span>前台显示距离范围：</th> 
                        <td>
                            <input type="text" name="value" id="value"  value="<?php echo $data['value'] ?>" class="px" style="width:400px;" place="请填入正整数" />
                        </td> 
                    </tr> 

                    <tr>         
                        <th>&nbsp;</th>
                        <td>
                            <button type="button" name="button" class="btnGreen" id="save">保存</button> &nbsp; <a href="javascript:void(0);" onclick='window.history.go(-1);' class="btnGray vm">取消</a></td> 
                    </tr> 
                </tbody> 
            </table> 
        </div>
    </form>
</div> 




<script type="text/javascript" id="j_ueditorupload"></script>
<script type="text/javascript">
    var gimgid = '';
    var gis_more = '';

    //实例化编辑器
    var o_ueditorupload = UE.getEditor('j_ueditorupload');
    o_ueditorupload.ready(function () {
        o_ueditorupload.hide();//隐藏编辑器     
        //监听图片上传
        o_ueditorupload.addListener('beforeInsertImage', function (t, arg) {
            if (gis_more == '0') {
                $("#" + gimgid).val(arg[0].src);
                $("#" + gimgid + '_url').attr('src', arg[0].src);
            } else {
                var html = '';
                var img_value = '';
                var num = arg.length;
                if (num > 6) {
                    alert("您上传的图片超过6张!");
                    return false;
                } else {
                    for (var i = 0; i < num; i++) {
                        img_value += arg[i].src + ',';
                        html += '<img src="' + arg[i].src + '"style="max-height:100px; margin:0 1rem 1rem 0;"/>';
                    }
                }
                $("#" + gimgid + "_div").html(html);
                $("#" + gimgid).val(img_value);
            }
        });
        /* 文件上传监听
         * 需要在ueditor.all.min.js文件中找到
         * d.execCommand("insertHtml",l)
         * 之后插入d.fireEvent('afterUpfile',b)
         */
        o_ueditorupload.addListener('afterUpfile', function (t, arg) {

        });
    });

    //弹出图片上传的对话框
    function upImage(imgid, is_more) {
        gimgid = imgid;
        gis_more = is_more;
        var myImage = o_ueditorupload.getDialog("insertimage");
        myImage.open();
    }
    //弹出文件上传的对话框
    function upFiles() {
        var myFiles = o_ueditorupload.getDialog("attachment");
        myFiles.open();
    }
</script>




<script type="text/javascript">
    $(document).ready(function () {

        $("#save").click(function () {
            var value = $('#value').val();
            if (value == null || value == '') {
                alert('请填写距离值');
                return;
            }


            var data = {
                value: value,
                token: '{pigcms:$token}',
            };

            $.post('index.php?g=User&m=Apiext&a=save_set', data, function (response) {
                if (response.error_code == false) {
                    art.dialog({
                        title: '消息提示',
                        content: response.msg,
                        width: 300,
                        height: 200,
                        lock: true,
                        ok: function () {
                            this.time(3);
                            location.href = "index.php?g=User&m=Apiext&a=extlist&token={pigcms:$token}";
                            return false;
                        },
                        cancelVal: '关闭'
                    });
                } else {
                    art.dialog({title: '消息提示', time: 2, width: 300, height: 200, content: response.msg});
                }

            }, 'json');
        })
    });
</script>
<include file="Public:footer" />