<include file="Public:head"/>  
<script src="/tpl/static/artDialog/jquery.artDialog.js?skin=default"></script>
<script src="/tpl/static/artDialog/plugins/iframeTools.js"></script>
<script src="{pigcms::RES}/js/cart/jscolor.js" type="text/javascript"></script>
<style>
    #tags li{
        height:35px;line-height: 1.5em;
    }

</style>
<div class="content">
    <div class="cLineB"> 
        <h4>兑换点列表</h4> 
    </div>
    <div style="background:#fefbe4;border:1px solid #f3ecb9;color:#993300;padding:10px;margin-top:5px;">
        <span>温馨提示：请按提示操作</span>
    </div>

    <div id="tags">
        <a href="javascript:void(0)" class="chooseall " val=true style="background-color:#2F8BC9;text-align:center;display:inline-block;height:20px;border-radius:2px; padding:2px 8px;line-height: 1.5em;color:#fff;font-size:14px;text-decoration: none;"   >全选/取消</a>
        <a href="javascript:void(0)" onclick="delAll()" style="background-color:#2F8BC9;text-align:center;display:inline-block;height:20px;border-radius:2px; padding:2px 8px;line-height: 1.5em;color:#fff;font-size:14px;text-decoration: none;">删除</a>
        <a href="{pigcms::U('Apiext/add_ext',array('token'=>$token))}" class="btnGreen">添加兑换站点</a>
        <a href="{pigcms::U('Apiext/setext',array('token'=>$token))}" class="btnGreen">兑换站点显示范围设置</a>
        <a href="javascript:void(0)" onclick="excel_out()" class="btnGreen">导出勾选或全部列表</a>
        <form id="myform" method="post" action='index.php?g=HuanleduiAdmin&m=Apiext&a=extlist&&token={pigcms:$token}' style="float:right">
            <input type="text" value="{pigcms::I('search')}" name="search" placeholder="请输入兑换站点名称或电话" style="right:140px;display:inline-block;height:31px;width:200px;border-radius:2px; padding:2px 8px;line-height: 1.5em;font-size:14px;border:1px solid #EEEEEE;"/>
            <input type="submit" value="搜索" style="right:80px;display:inline-block;height:31px;width:50px;border-radius:2px;color:#fff;padding:2px 8px;line-height:1.5em;background-color:#2F8BC9;font-size:14px;"/>
        </form>
    </div>
    <div class="msgWrap">
        <form method="post"  action="" id="info" >
            <input type="hidden" name="token" value="{pigcms:$token}" id="mb_id">
            <TABLE class="ListProduct" border="0" cellSpacing="0" cellPadding="0" width="100%">
                <THEAD>
                    <tr>
                        <th style="width:50px;text-align:center">选择</th>
                        <!--<th width="60" style="text-align:center">兑换点id</th>-->
                        <th width="120" style="text-align:center">兑换点称</th>
                        <th width="120" style="text-align:center">兑换点电话</th>
                        <th width="120" style="text-align:center">经度</th>
                        <th width="120" style="text-align:center">纬度</th>
                        <th width="100" style="text-align:center">操作</th>
                    </tr>
                </THEAD>
                <TBODY>
                    <TR></TR>
                <volist id="item" name="ext_list">
                    <TR>
                        <TD style="text-align:center"><input type="checkbox" name="c_id[]" value="{pigcms:$item.id}" class="checkitem"></TD>
                        <!--<TD style="text-align:center">{pigcms:$item.id}</TD>-->
                        <TD style="text-align:center">{pigcms:$item.title}</TD>
                        <TD style="text-align:center">{pigcms:$item.tel}</TD>
                        <TD style="text-align:center">{pigcms:$item.longitude}</TD>
                        <TD style="text-align:center">{pigcms:$item.latitude}</TD>
                        <TD style="text-align:center"> <a href="/index.php?g=HuanleduiAdmin&m=Apiext&a=edit&token={pigcms:$token}&id={pigcms:$item.id}">编辑</a>
                            <a href="javascript:void(0)" onclick="del('{pigcms:$item.id}')">删除</a></TD>
                    </TR>
                </volist>
                </TBODY>
            </TABLE>
        </form>

    </div>
    <div class="cLine">
        <div class="pageNavigator right">
            <div class="pages">{pigcms:$page}</div>
        </div>
        <div class="clr"></div>
    </div>
</div>  
<div class="clr"></div>
<include file="Public:footer"/>
</div>
</div>
</div> 

<script>
    /*
     * 功能：全选/取消
     * date:2016/06/30 11:29
     * @par:ver 1.0 create by huangweiming
     * @returns {undefined}
     */
    $(".chooseall").attr("val", "checked");
    $(".chooseall").click(function () {
        if ($(".chooseall").attr("val") == "checked") {
            $(".checkitem").attr("checked", "checked");
            $(".chooseall").attr("val", "")
        } else {
            $(".checkitem").attr("checked", "");
            $(".chooseall").attr("val", "checked")
        }
    });
//删除记录
    function del(id)
    {
        art.dialog({
            title: '消息提示',
            content: '确定要删除吗？',
            lock: true,
            okVal: '确定',
            ok: function () {
                var data = {id: id, token: '{pigcms:$token}'};
                $.post('index.php?g=HuanleduiAdmin&m=Apiext&a=del_apiext', data, function (response) {
                    if (response.status == 1) {
                        art.dialog({
                            title: '消息提示',
                            content: response.info,
                            lock: true
                        });
                        setInterval(function () {
                            location.href = response.url;
                        }, 2000);
                    } else {
                        art.dialog({title: '消息提示', time: 2, content: response.info});
                    }

                }, 'json');
            },
            cancelVal: '取消',
            cancel: true
        });

    }
    /*
     * 功能：执行全部删除操作
     * date:2016/06/30 11:29
     * @par:ver 1.0 create by huangweiming
     * @returns {undefined}
     */

    function delAll() {
        var id = [];
        var k = 0;
        $(".checkitem").each(function (i) {
            if ($(this).attr("checked")) {
                id[k] = $(this).val();
                k++;
            }
        });
        if (!id || id == null || id == '') {
            art.dialog({
                title: '消息提示',
                content: '您还没有勾选要删除的选项!',
                lock: true,
                time: 2
            });
            return;
        }
        var data = {id: id, token: '{pigcms:$token}'};
        art.dialog({
            title: '消息提示',
            content: '确定要删除吗？',
            lock: true,
            okVal: '确定',
            ok: function () {
                $.post('index.php?g=HuanleduiAdmin&m=Apiext&a=del_apiext', data, function (response) {
                    if (response.status == 1) {
                        art.dialog({
                            title: '消息提示',
                            content: response.info,
                            lock: true
                        });
                        setInterval(function () {
                            location.href = response.url;
                        }, 2000);
                    } else {
                        art.dialog({title: '消息提示', time: 2, content: response.msg});
                    }

                }, 'json');
            },
            cancelVal: '取消',
            cancel: true
        });
    }

    /*
     * 功能：导出excel
     * date:2016/07/06 11:00
     * @par:ver 1.0 create by huangweiming
     * @returns {undefined}
     */
    function excel_out() {
        var id = [];
        var k = 0;
        $(".checkitem").each(function (i) {
            if ($(this).attr("checked")) {
                id[k] = $(this).val();
                k++;
            }
        });
        var data = '';
        var content = "";
        if (!id || id == null || id == '') {
            content = "你确定要导出全部数据吗？";
        } else {
            content = "你确定要导出所选的这些数据吗";
            id = id.join(",");
            data = "&id=" + id;
        }
        art.dialog({
            title: '消息提示',
            content: content,
            lock: true,
            okVal: '确定',
            ok: function () {
                var link = "{pigcms::U('Apiext/excel_out')}";
                link = link + data;
                location.href = link;
            },
            cancelVal: '取消',
            cancel: true
        });

    }

</script>

<script>
// 全选/反选
    $(function () {
        $(".checkall").click(function () {
            var that = this;
            var val = $(that).attr('checked');
            $(".checkitem").each(function () {
                $(this).attr('checked', val);
            })
        })
        $(".checkitem").click(function () {
            var that = this;
            var val = $(that).attr('checked');
            if (val) //如果全部选中则是全选
            {
                var flag = 1;
                $(".checkitem").each(function () {
                    var item = $(this).attr('checked');
                    if (item == false)
                    {
                        flag = 0;
                    }
                })
                if (flag == 1)
                {
                    $(".checkall").attr('checked', val);
                }
            } else //只要有没选中的就不是全选
            {
                var flag = 0;
                $(".checkall").attr('checked', val);
            }
        })
    })


</script>


